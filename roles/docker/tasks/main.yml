- name: Include OS-specific variables.
  include_vars: "docker_vars.yml"

- name: install docker SElinux policies (requiered for Centos)
  yum: name=docker-selinux
       state=absent

- name: Update the complete system
  yum: name=*
       state=latest

- name: Install python setup tools
  yum: name=python-setuptools

- name: Install Pypi
  easy_install: name=pip

- name: Install docker-py
  pip: name=docker-py

- name: configure docker yum repository
  copy: src=docker.repo
        dest=/etc/yum.repos.d/
        owner=root group=root mode=0644

- name: install docker
  yum: name={{ docker_engine_version }}*
       state=present

- name: start docker daemon
  service: name=docker
           state=started
           enabled=yes

- name: create a docker user group
  group: name=docker
         state=present

- name: add listed users to the docker group
  user: name="{{ item }}"
        groups=docker
        append=yes
  with_items: "{{dockerUsers}}"

- name: install docker compose
  pip: name=docker-compose
       version="{{ docker_compose_version if docker_compose_version else omit }}"
       state=present

- name: Setting permissions on docker compose
  file:
      path: /usr/bin/docker-compose
      group: root
      owner: root
      mode: "0755"

- name: Directory to store the docker-compose config
  file: path={{ work_dir }}/docker state=directory owner=root group=root

- name: copy empty docker-compose file
  copy: src=files/empty-compose.yml
            dest={{ work_dir }}/docker/docker-compose.yml
            force=no

- name: Update restart_web bash and copy
  template: src=restart_web.j2
            dest={{ work_dir }}/docker/restart_web.sh
            mode="a+rx"
            force=yes
