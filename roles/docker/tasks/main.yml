- name: Include OS-specific variables.
  include_vars: "docker_vars.yml"

- name: Update the complete system
  yum: name=*
       state=latest

- name: Install python setup tools
  yum: name=python-setuptools

- name: Install Pypi
  easy_install: name=pip

- name: Install docker-py
  pip: name=docker-py

- name: configure docker yum repository
  copy: src=docker.repo
        dest=/etc/yum.repos.d/
        owner=root group=root mode=0644

- name: install docker
  yum: name=docker-engine
       state=present

- name: install docker SElinux policies (requiered for Centos)
  yum: name=docker-selinux
       state=present

- name: start docker daemon
  service: name=docker
           state=started
           enabled=yes

- name: create a docker user group
  group: name=docker
         state=present

- name: add listed users to the docker group
  user: name="{{ item }}"
        groups=docker
        append=yes
  with_items: dockerUsers

- name: install docker compose
  pip: name=docker-compose
       version="{{ docker_compose_version if docker_compose_version else omit }}"
       state=present

- name: Setting permissions on docker compose
  file:
      path: /usr/bin/docker-compose
      group: root
      owner: root
      mode: "0755"

- name: Directory to store the docker-compose config
  file: path=/var/docker state=directory owner=root group=root