version: '2'

services:

  web:
    depends_on:
      - jenkins

  jenkins:
    build: ./jenkins-dockerfile
    environment:
      - JENKINS_OPTS=--httpPort=8080
      - JENKINS_SLAVE_AGENT_PORT=50000
      - JAVA_OPTS=-Djenkins.install.runSetupWizard=false
    volumes:
      - jenkins2-data:/var/jenkins_home
      - {{ work_dir }}/ci/ssh-keys:/ssh-keys
    env_file:
      - {{ work_dir }}/ci/GitHub_OAuth_IDs.env
    restart: unless-stopped

  ssh-agent:
    image: jenkinsci/ssh-slave
    env_file:
      - {{ work_dir }}/ci/ssh-keys/slave-keys.env

volumes:

  jenkins2-data:
    driver: local

  jenkins-keys:
    driver: local

